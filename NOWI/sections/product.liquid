{% assign current_variant = product.selected_or_first_available_variant %}
{% assign on_sale = current_variant.compare_at_price > current_variant.price %}

<section class="product">
  <div class="container">
    <div class="product-layout">
      <div class="product-media-gallery" role="group" aria-label="{{ 'products.product.media' | t }}">
        {% if product.media.size > 0 %}
          {% for media in product.media %}
            {% assign media_alt = media.alt | default: product.title | escape %}
            <div class="product-media">
              {% case media.media_type %}
                {% when 'image' %}
                  {{ media | image_url: width: 1200 | image_tag: loading: 'lazy', alt: media_alt }}
                {% when 'video' %}
                  {{ media | video_tag: controls: true }}
                {% when 'external_video' %}
                  {{ media | external_video_tag }}
                {% when 'model' %}
                  {{ media | model_viewer_tag: reveal: 'interaction', toggleable: true }}
              {% endcase %}
            </div>
          {% endfor %}
        {% else %}
          <div class="product-media">
            {{ 'product-1' | placeholder_svg_tag }}
          </div>
        {% endif %}
      </div>

      <div class="product-info">
        <div class="product-breadcrumb">
          <a href="{{ routes.all_products_collection_url }}">{{ 'products.product.back_to_products' | t }}</a>
        </div>
        <h1 class="product-title">{{ product.title | escape }}</h1>
        <div class="product-price">
          <span>{{ current_variant.price | money }}</span>
          {% if on_sale %}
            <s>{{ current_variant.compare_at_price | money }}</s>
            <span class="pill">-{{ current_variant.compare_at_price | minus: current_variant.price | times: 100 | divided_by: current_variant.compare_at_price | round }}%</span>
          {% endif %}
        </div>
        {% if section.settings.product_subheading != blank %}
          <p class="section-subheading">{{ section.settings.product_subheading | escape }}</p>
        {% endif %}

        {% if section.blocks.size > 0 %}
          <ul class="product-highlights">
            {% for block in section.blocks %}
              {% if block.type == 'highlight' %}
                <li {{ block.shopify_attributes }}>{{ block.settings.text | escape }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        {% endif %}

        {% form 'product', product, class: 'product-form' %}
          <input type="hidden" name="id" value="{{ current_variant.id }}">
          <div class="product-variants">
            {% for option in product.options_with_values %}
              <fieldset class="variant-group" data-option-position="{{ option.position }}">
                <legend>{{ option.name }}</legend>
                <div class="variant-options">
                  {% for value in option.values %}
                    {% assign variant_available = false %}
                    {% for variant in product.variants %}
                      {% if variant.option{{ option.position }} == value and variant.available %}
                        {% assign variant_available = true %}
                        {% break %}
                      {% endif %}
                    {% endfor %}
                    {% assign input_id = section.id | append: '-' | append: option.position | append: '-' | append: forloop.index %}
                    <input class="visually-hidden" type="radio" id="Option-{{ input_id }}" name="options[{{ option.name }}]" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} {% unless variant_available %}disabled{% endunless %}>
                    <label for="Option-{{ input_id }}" class="variant-option" {% unless variant_available %}aria-disabled="true"{% endunless %}>{{ value }}</label>
                  {% endfor %}
                </div>
              </fieldset>
            {% endfor %}
          </div>

          <div class="product-actions">
            <label class="visually-hidden" for="Quantity-{{ section.id }}">{{ 'products.product.quantity' | t }}</label>
            <input id="Quantity-{{ section.id }}" name="quantity" type="number" value="1" min="1">
            <button type="submit" name="add" class="btn btn-primary" data-available-label="{{ section.settings.add_to_cart_label | escape }}" data-sold-out-label="{{ section.settings.sold_out_label | escape }}" {% unless product.available %}disabled{% endunless %}>{{ section.settings.add_to_cart_label | escape }}</button>
            {% if section.settings.show_buy_now %}
              {{ form | payment_button }}
            {% endif %}
          </div>
        {% endform %}

        <div class="product-assurance">
          {% if section.settings.delivery_info != blank %}
            <p>{{ section.settings.delivery_info | escape }}</p>
          {% endif %}
          {% if section.settings.returns_info != blank %}
            <p>{{ section.settings.returns_info | escape }}</p>
          {% endif %}
        </div>

        {% assign badge_blocks = section.blocks | where: 'type', 'badge' %}
        {% if badge_blocks.size > 0 %}
          {% render 'trust-badges', badges: badge_blocks %}
        {% endif %}

        <div class="product-accordion">
          {% for block in section.blocks %}
            {% if block.type == 'accordion' %}
              <details {{ block.shopify_attributes }}>
                <summary>{{ block.settings.heading | escape }}</summary>
                <div class="product-accordion__content">{{ block.settings.content }}</div>
              </details>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>
<script type="application/json" data-product-json>
  {{ product | json }}
</script>

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "type": "textarea",
      "id": "product_subheading",
      "label": "Intro text",
      "default": "Performance-grade denim engineered with four-way stretch and recycled fibres."
    },
    {
      "type": "text",
      "id": "add_to_cart_label",
      "label": "Add to cart label",
      "default": "Add to cart"
    },
    {
      "type": "text",
      "id": "sold_out_label",
      "label": "Sold out label",
      "default": "Sold out"
    },
    {
      "type": "checkbox",
      "id": "show_buy_now",
      "label": "Show dynamic checkout button",
      "default": true
    },
    {
      "type": "text",
      "id": "delivery_info",
      "label": "Delivery info",
      "default": "Ships in 24 hours from our Bengaluru studio."
    },
    {
      "type": "text",
      "id": "returns_info",
      "label": "Returns info",
      "default": "Easy 7-day exchanges on all full-price styles."
    }
  ],
  "blocks": [
    {
      "type": "highlight",
      "name": "Highlight",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Ultra-soft interior with moisture wicking tech"
        }
      ]
    },
    {
      "type": "badge",
      "name": "Trust badge",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icon",
          "default": "ðŸšš"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Fast delivery"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description",
          "default": "Free shipping above â‚¹999 across India"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Fabric & care"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>73% organic cotton, 24% recycled poly, 3% elastane. Machine wash cold.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product",
      "blocks": [
        { "type": "highlight" },
        { "type": "highlight" },
        { "type": "badge" },
        { "type": "accordion" },
        { "type": "accordion" }
      ]
    }
  ]
}
{% endschema %}
