<header class="site-header" data-site-header>
  <div class="site-header__inner">
    <button class="site-header__menu-toggle" data-menu-toggle aria-controls="MobileMenu-{{ section.id }}" aria-expanded="false">
      <span class="visually-hidden">Toggle navigation</span>
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"></path></svg>
    </button>

    <a class="site-header__logo" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
      {% if section.settings.logo != blank %}
        {% assign logo = section.settings.logo %}
        {% assign logo_width_2x = section.settings.logo_width | times: 2 %}
        <img
          src="{{ logo | image_url: width: section.settings.logo_width }}"
          srcset="{{ logo | image_url: width: section.settings.logo_width }} 1x, {{ logo | image_url: width: logo_width_2x }} 2x"
          alt="{{ shop.name }}"
          style="max-width: {{ section.settings.logo_width }}px;"
        >
      {% else %}
        <span>{{ shop.name | escape }}</span>
      {% endif %}
    </a>

    {% if section.settings.show_search %}
      <div class="site-header__search" data-search-container>
        <form action="{{ routes.search_url }}" method="get" role="search">
          <label class="visually-hidden" for="SearchInput-{{ section.id }}">Search</label>
          <input id="SearchInput-{{ section.id }}" type="search" name="q" placeholder="{{ section.settings.search_placeholder | escape }}" value="{{ search.terms | escape }}">
          <button type="submit" aria-label="Search store">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.57-4.23A6.5 6.5 0 109.5 16a6.47 6.47 0 004.23-1.57l.27.28v.79l5 5L20.49 19l-5-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
          </button>
        </form>
      </div>
    {% endif %}

    <div class="site-header__actions">
      {% if section.settings.show_search %}
        <button class="site-header__icon site-header__icon--search" data-search-toggle aria-expanded="false" aria-controls="SearchDrawer-{{ section.id }}">
          <span class="visually-hidden">Search</span>
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.57-4.23A6.5 6.5 0 109.5 16a6.47 6.47 0 004.23-1.57l.27.28v.79l5 5L20.49 19l-5-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
        </button>
      {% endif %}
      {% if shop.customer_accounts_enabled and section.settings.show_account %}
        <a class="site-header__icon" href="{{ routes.account_url }}" aria-label="Account">
          {{ 'icon-account.svg' | inline_asset_content }}
        </a>
      {% endif %}
      <a class="site-header__icon site-header__icon--cart" href="{{ routes.cart_url }}" aria-label="Cart">
        {{ 'icon-cart.svg' | inline_asset_content }}
        <span class="site-header__cart-count" data-cart-count>{% if cart.item_count > 0 %}{{ cart.item_count }}{% endif %}</span>
      </a>
    </div>
  </div>

  {% assign menu_handle = section.settings.main_menu | default: section.settings.mobile_menu %}
  {% if menu_handle != blank and linklists[menu_handle] %}
    <nav class="site-header__desktop-nav" aria-label="Main navigation">
      <ul>
        {% for link in linklists[menu_handle].links %}
          <li>
            <a href="{{ link.url }}">{{ link.title | escape }}</a>
          </li>
        {% endfor %}
      </ul>
    </nav>
  {% endif %}

  <div class="site-header__mobile-drawer" id="MobileMenu-{{ section.id }}" hidden>
    <div class="site-header__mobile-drawer-inner">
      <div class="site-header__mobile-top">
        <span class="site-header__mobile-title">{{ section.settings.mobile_menu_title | escape }}</span>
        <button class="site-header__mobile-close" data-menu-close aria-label="Close menu">&times;</button>
      </div>
      {% assign mobile_menu_handle = section.settings.mobile_menu | default: section.settings.main_menu %}
      {% if mobile_menu_handle != blank and linklists[mobile_menu_handle] %}
        <nav class="site-header__mobile-nav" aria-label="Main navigation">
          <ul>
            {% for link in linklists[mobile_menu_handle].links %}
              <li>
                <a href="{{ link.url }}">{{ link.title | escape }}</a>
              </li>
            {% endfor %}
          </ul>
        </nav>
      {% endif %}
      {% if section.blocks.size > 0 %}
        <div class="site-header__mobile-links">
          {% for block in section.blocks %}
            {% if block.type == 'quick_link' %}
              <a href="{{ block.settings.link }}" class="site-header__mobile-quick-link">{{ block.settings.text | escape }}</a>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  {% if section.settings.show_search %}
    <div class="site-header__search-drawer" id="SearchDrawer-{{ section.id }}" hidden>
      <form action="{{ routes.search_url }}" method="get" role="search">
        <label class="visually-hidden" for="SearchDrawerInput-{{ section.id }}">Search</label>
        <input id="SearchDrawerInput-{{ section.id }}" type="search" name="q" placeholder="{{ section.settings.search_placeholder | escape }}" value="{{ search.terms | escape }}">
        <button type="submit">{{ section.settings.search_button_text | escape }}</button>
      </form>
    </div>
  {% endif %}
</header>

<style>
  .visually-hidden {
    position: absolute;
    clip: rect(0 0 0 0);
    width: 1px;
    height: 1px;
    margin: -1px;
    overflow: hidden;
  }
  .site-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: rgba(255, 255, 255, 0.96);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }
  .site-header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem var(--page-margin);
    gap: 1rem;
  }
  .site-header__menu-toggle {
    border: none;
    background: none;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .site-header__menu-toggle svg {
    width: 1.5rem;
    height: 1.5rem;
  }
  .site-header__logo {
    font-weight: 700;
    font-size: 1.2rem;
    color: inherit;
    text-decoration: none;
  }
  .site-header__logo img {
    height: auto;
    max-height: 2.5rem;
  }
  .site-header__search {
    flex: 1 1 auto;
    display: none;
  }
  .site-header__search form {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #f6f6f6;
    padding: 0.5rem 0.75rem;
    border-radius: 999px;
  }
  .site-header__search input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 0.95rem;
    outline: none;
  }
  .site-header__search button {
    border: none;
    background: none;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .site-header__actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .site-header__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: inherit;
    text-decoration: none;
    position: relative;
  }
  .site-header__icon svg {
    width: 1.4rem;
    height: 1.4rem;
  }
  .site-header__cart-count {
    position: absolute;
    top: -0.25rem;
    right: -0.45rem;
    background: #111;
    color: #fff;
    border-radius: 999px;
    padding: 0 0.35rem;
    font-size: 0.7rem;
    min-width: 1.2rem;
    text-align: center;
    font-weight: 600;
  }
  .site-header__cart-count:empty {
    display: none;
  }
  .site-header__desktop-nav {
    display: none;
  }
  .site-header__desktop-nav ul {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    padding: 0 0 0.75rem;
    list-style: none;
  }
  .site-header__desktop-nav a {
    text-decoration: none;
    color: inherit;
    font-weight: 500;
  }
  .site-header__mobile-drawer {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: none;
    z-index: 60;
  }
  .site-header__mobile-drawer[open],
  .site-header__mobile-drawer[aria-hidden="false"] {
    display: block;
  }
  .site-header__mobile-drawer-inner {
    background: #fff;
    max-width: 320px;
    width: 85%;
    height: 100%;
    padding: 1.5rem;
    overflow-y: auto;
  }
  .site-header__mobile-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .site-header__mobile-close {
    font-size: 1.5rem;
    border: none;
    background: none;
  }
  .site-header__mobile-nav ul {
    list-style: none;
    display: grid;
    gap: 1rem;
  }
  .site-header__mobile-nav a {
    text-decoration: none;
    color: inherit;
    font-size: 1.05rem;
    font-weight: 500;
  }
  .site-header__mobile-links {
    margin-top: 2rem;
    display: grid;
    gap: 0.75rem;
  }
  .site-header__mobile-quick-link {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    padding: 0.75rem;
    border-radius: 999px;
    background: #111;
    color: #fff;
    text-decoration: none;
    font-weight: 600;
  }
  .site-header__search-drawer {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: none;
    z-index: 70;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
  }
  .site-header__search-drawer form {
    width: 100%;
    max-width: 420px;
    background: #fff;
    padding: 1.5rem;
    border-radius: 1rem;
    display: grid;
    gap: 0.75rem;
  }
  .site-header__search-drawer input {
    width: 100%;
    padding: 0.75rem 1rem;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  .site-header__search-drawer button {
    padding: 0.75rem 1rem;
    border-radius: 999px;
    border: none;
    background: #111;
    color: #fff;
    font-weight: 600;
  }

  @media (min-width: 768px) {
    .site-header__menu-toggle {
      display: none;
    }
    .site-header__search {
      display: block;
    }
    .site-header__actions .site-header__icon--search {
      display: none;
    }
    .site-header__desktop-nav {
      display: block;
    }
  }
</style>

<script>
  (function () {
    var header = document.querySelector('[data-site-header]');
    if (!header) return;
    var menuToggle = header.querySelector('[data-menu-toggle]');
    var menuDrawer = document.getElementById('MobileMenu-{{ section.id }}');
    var closeButton = header.querySelector('[data-menu-close]');
    function openMenu() {
      if (!menuDrawer) return;
      menuDrawer.hidden = false;
      menuDrawer.setAttribute('aria-hidden', 'false');
      menuToggle && menuToggle.setAttribute('aria-expanded', 'true');
    }
    function closeMenu() {
      if (!menuDrawer) return;
      menuDrawer.hidden = true;
      menuDrawer.setAttribute('aria-hidden', 'true');
      menuToggle && menuToggle.setAttribute('aria-expanded', 'false');
    }
    if (menuToggle && menuDrawer) {
      menuToggle.addEventListener('click', function () {
        if (menuDrawer.hidden || menuDrawer.getAttribute('aria-hidden') === 'true') {
          openMenu();
        } else {
          closeMenu();
        }
      });
    }
    if (closeButton) {
      closeButton.addEventListener('click', closeMenu);
    }
    if (menuDrawer) {
      menuDrawer.addEventListener('click', function (event) {
        if (event.target === menuDrawer) {
          closeMenu();
        }
      });
    }

    var searchToggle = header.querySelector('[data-search-toggle]');
    var searchDrawer = document.getElementById('SearchDrawer-{{ section.id }}');
    function openSearch() {
      if (!searchDrawer) return;
      searchDrawer.hidden = false;
      searchDrawer.style.display = 'flex';
      searchToggle && searchToggle.setAttribute('aria-expanded', 'true');
      var input = searchDrawer.querySelector('input');
      if (input) {
        setTimeout(function () {
          input.focus();
        }, 50);
      }
    }
    function closeSearch() {
      if (!searchDrawer) return;
      searchDrawer.hidden = true;
      searchDrawer.style.display = 'none';
      searchToggle && searchToggle.setAttribute('aria-expanded', 'false');
    }
    if (searchToggle && searchDrawer) {
      searchToggle.addEventListener('click', function () {
        if (searchDrawer.hidden) {
          openSearch();
        } else {
          closeSearch();
        }
      });
      searchDrawer.addEventListener('click', function (event) {
        if (event.target === searchDrawer) {
          closeSearch();
        }
      });
    }
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Escape') {
        closeSearch();
        closeMenu();
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo width",
      "default": 160,
      "min": 80,
      "max": 320,
      "step": 10
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Desktop menu"
    },
    {
      "type": "link_list",
      "id": "mobile_menu",
      "label": "Mobile menu"
    },
    {
      "type": "text",
      "id": "mobile_menu_title",
      "label": "Mobile menu heading",
      "default": "Browse"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder",
      "default": "Search denim, tops, jackets..."
    },
    {
      "type": "text",
      "id": "search_button_text",
      "label": "Search button text",
      "default": "Search"
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show account icon",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "quick_link",
      "name": "Quick link",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Link text",
          "default": "Track Order"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Header",
      "blocks": [
        {
          "type": "quick_link"
        },
        {
          "type": "quick_link"
        }
      ]
    }
  ]
}
{% endschema %}
